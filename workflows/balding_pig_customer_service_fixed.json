{
  "name": "Balding Pig - Customer Service",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "balding-pig-support",
        "responseMode": "responseNode"
      },
      "id": "customer_webhook",
      "name": "Customer Inquiry Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "code": "// CUSTOMER INQUIRY PROCESSOR\n// Parse and categorize customer inquiries\n\nconst inquiry = {\n  message: $json.body.message || $json.body.text || 'No message provided',\n  customer_email: $json.body.email || 'unknown@email.com',\n  platform: $json.body.platform || 'webhook',\n  timestamp: new Date().toISOString(),\n  priority: 'normal'\n};\n\n// Categorize inquiry type\nconst message = inquiry.message.toLowerCase();\n\nif (message.includes('order') || message.includes('tracking') || message.includes('delivery')) {\n  inquiry.category = 'order_support';\n  inquiry.priority = 'high';\n} else if (message.includes('return') || message.includes('refund') || message.includes('exchange')) {\n  inquiry.category = 'returns';\n  inquiry.priority = 'high';\n} else if (message.includes('size') || message.includes('fit') || message.includes('sizing')) {\n  inquiry.category = 'product_info';\n} else if (message.includes('complaint') || message.includes('problem') || message.includes('issue')) {\n  inquiry.category = 'complaint';\n  inquiry.priority = 'urgent';\n} else {\n  inquiry.category = 'general';\n}\n\nreturn { json: inquiry };"
      },
      "id": "inquiry_processor", 
      "name": "Process Inquiry",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "gpt-4"
            },
            {
              "name": "messages", 
              "value": "=[{\"role\": \"system\", \"content\": \"You are The Balding Pig customer service AI. You're witty, helpful, and slightly sarcastic - matching the brand's satirical tone. Handle inquiries about bald-themed merchandise with humor but provide accurate information. Keep responses under 150 words. Category: {{ $json.category }}\"}, {\"role\": \"user\", \"content\": \"Customer inquiry: {{ $json.message }}\"}]"
            },
            {
              "name": "max_tokens",
              "value": "200"
            }
          ]
        }
      },
      "id": "ai_responder",
      "name": "AI Customer Response",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [650, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "operation": "equal"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.priority }}",
              "rightValue": "urgent",
              "operation": "equal"
            }
          ]
        }
      },
      "id": "priority_router",
      "name": "Priority Router", 
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "url": "mailto:{{ $json.customer_email }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Subject",
              "value": "Re: Your Balding Pig Inquiry"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message",
              "value": "={{ $('ai_responder').item.json.choices[0].message.content }}"
            },
            {
              "name": "signature",
              "value": "\\n\\nBest regards,\\nThe Balding Pig Support Team\\n\\n(This response was generated by AI, but our chrome domes are real!)"
            }
          ]
        }
      },
      "id": "email_response",
      "name": "Send Email Response",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1050, 200]
    },
    {
      "parameters": {
        "url": "https://webhook.site/urgent-alerts",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "alert",
              "value": "urgent_customer_inquiry"
            },
            {
              "name": "customer",
              "value": "={{ $json.customer_email }}"
            },
            {
              "name": "message", 
              "value": "={{ $json.message }}"
            },
            {
              "name": "category",
              "value": "={{ $json.category }}"
            }
          ]
        }
      },
      "id": "urgent_alert",
      "name": "Send Urgent Alert",
      "type": "n8n-nodes-base.httpRequest", 
      "typeVersion": 4,
      "position": [1050, 400]
    },
    {
      "parameters": {
        "mode": "responseNode",
        "responseBody": "={{ $('ai_responder').item.json.choices[0].message.content }}",
        "options": {}
      },
      "id": "webhook_response",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1250, 300]
    }
  ],
  "connections": {
    "customer_webhook": {
      "main": [
        [
          {
            "node": "inquiry_processor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "inquiry_processor": {
      "main": [
        [
          {
            "node": "ai_responder", 
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ai_responder": {
      "main": [
        [
          {
            "node": "priority_router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "priority_router": {
      "main": [
        [
          {
            "node": "urgent_alert",
            "type": "main", 
            "index": 0
          }
        ],
        [
          {
            "node": "email_response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "email_response": {
      "main": [
        [
          {
            "node": "webhook_response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "urgent_alert": {
      "main": [
        [
          {
            "node": "webhook_response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "id": "balding_pig_customer_service"
}